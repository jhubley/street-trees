<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  margin: 0;
}

#container {
  position: relative;
  overflow: hidden;
	background: #35363b;
}

#map{
	width:100%;
	height:100%;
}

#points{
	width:100%;
	height:100%;
	position:relative;
	z-index:100;
}

.layer {
  position: absolute;
}

.tile {
  pointer-events: none;
  position: absolute;
  width: 256px;
  height: 256px;
}

.info {
  position: absolute;
  bottom: 0px;
  left: 0px;
	padding: 20px;
	background: #000;
	color: #fff;
	width: 260px;
	z-index: 1000;
	font-family:Helvetica, Arial, sans-serif;
	font-size:16px;
	color: #999;
	opacity:0.9;
}

.info a{
	color: #ccc;
	text-decoration: none;
}

#leftbox{
	float:left;
}

#rightbox{
	position:absolute;
	right:80px;
}

.d3-tip {
  line-height: 1;
  font-weight: normal;
	font-family: Helvetica, Arial, sans-serif;
	font-size:13px;
  padding: 8px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 3px;
	position:relative;
	z-index:101;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 20px;
  width: 100%;
  line-height: .5;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}

button {
	width: 40px;
	height:30px;
	opacity: 1.0;
	background: #aaa;
	border: 1px solid #ccc;
	font-size:16px;
	color: #000;
}

button#zoom_in{
	position:absolute;
	top: 20px;
	left: 320px;
	z-index:9999;
}

button#zoom_out{
	position:absolute;
	top: 20px;
	left: 370px;
	z-index:9999
}

#overlay{
	position: absolute;
	z-index: 1000;
	font-family:Helvetica, Arial, sans-serif;
	font-size:16px;
	color: #fff;
	background: #000;
	opacity:0.7;
	width: 300px;
	height:100%;
	left:0;
	top:0px;
	padding: 0px 0px;
	overflow:visible;
}

h3{
	font-size: 16px !important;
	font-weight:normal !important;
	margin: 0px;
	padding:8px 0px 8px 20px;
	background:#333;
	width:280px;
	border-bottom:1px solid #222;
}

#legend {
	font-size: 16px;         
	cursor: pointer;
	position:relative;
	z-index: 1000;
	fill: #ffffff;
	width:280px;
	float: left;
	padding: 6px 0px 6px 20px;
	background: #111;
	border-bottom:1px solid #333;
}

#accordion{
	position:absolute;
}

#filter1{
	height:150px;
}

#diameters{
	position:absolute;
	bottom:76px;
	z-index:99999;
	padding-left:20px;
	padding-top:15px;
	padding-bottom:15px;
	border-top:1px solid #333;
	border-bottom:1px solid #333;
	width: 280px;
}
#diameters p{
	margin-top: 0px;
	font-size:13px;
}

#diamtext ul{
	padding:0px;
	margin:0px;
}
	
#diamtext li{
	list-style-type: none;
	list-style-image: none;
	font-size:12px;
	display:inline;
	padding-right:30px;
}
	
</style>
<body>
<script src="d3.min.js"></script>
<script src="d3.geo.tile.min.js"></script>
<script src="d3.tip.js"></script>
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
<button id="zoom_in">+</button>
<button id="zoom_out">-</button>
<div id="overlay">
	<div id="filters">
		<div id="accordion">
		  <h3>Filter by Species</h3>
		  <div id="filter1">
		  </div>
		  <h3>Filter by Genus</h3>
		  <div id ="filter2">
		  </div>
		  <h3>Filter by Family</h3>
		  <div id ="filter3">
		  </div>
		</div>
	</div>
	<div id="diameters">
		<p>Tree Trunk Diameter</p>
	<div id="diamcirc">
	<svg width="250" height="36">
		<!-- fourth block -->	
		<circle cx="15" cy="18" r="3" fill="#fff" />
		<circle cx="82" cy="18" r="6" fill="#fff" />
		<circle cx="159" cy="18" r="12" fill="#fff" />
		<circle cx="230" cy="18" r="18" fill="#fff" />
	</svg>
	</div>
	<div id="diamtext">
		<ul>
			<li>< 10"</li>
			<li>10 - 20"</li>
			<li>20 - 45"</li>
			<li>> 45"</li>
		</ul>
	</div>
	</div>
</div>
<script>

var width = Math.max(960, window.innerWidth),
    height = Math.max(500, window.innerHeight),
    prefix = prefixMatch(["webkit", "ms", "Moz", "O"]);
		
//original data load - all at once
// d3.csv("bktreeswgs84.csv", function(error, dataset) { createMap(dataset) });


// lazy data load. split big file up more, and add a queue maybe? still takes a while.
		d3.csv('tree11217.csv', function(err, smallCSV) {

		  // Start loading big file immediately
		  d3.csv('bktreeswgs84.csv', function(err, bigCSV) {
		    data = bigCSV // when big data is loaded it replaces old partial data
		    createMap(data) // redraw viz
		  })  

		  // This portion of code also starts immediately, while big file is still loading
		  data = smallCSV
		  createMap(data) // function which has all your d3 code and uses DS.data inside   
		});
		
		
var tile = d3.geo.tile()
    .size([width, height]);

var projection = d3.geo.mercator()
.scale((1 << 21) / 2 / Math.PI)
.translate([-width / 2, -height / 2]); // just temporary

var zoom = d3.behavior.zoom()
    .scale(projection.scale() * 2 * Math.PI)
    .scaleExtent([1 << 20, 1 << 25])
    .translate(projection([-73.978277, 40.6791989]).map(function(x) { return -x; }))
    .on("zoom", zoomed);

var container = d3.select("body").append("div")
    .attr("id", "container")
    .style("width", width + "px")
    .style("height", height + "px")
    .call(zoom);

var map = container.append("g")
		.attr("id", "map")

var points = container.append("svg")
		.attr("id", "points")
				
var layer = map.append("div")
    .attr("class", "layer");
					
var info = map.append("div")
    .attr("class", "info")
		.html("<div id='leftbox'><span style='color:#0096ff;'>Brooklyn Street Trees</span><br/>Data from <a href='https://nycopendata.socrata.com/Environment/Street-Tree-Census-Brooklyn-/ztcw-bzc8'>NYC Open Data</a></div>");

var trees = {
		ACPL: ['Norway Maple', 'Acer', 'platanoides', 'Sapindaceae', '#00567e'],
		ACRU: ['Red Maple', 'Acer', 'rubrum', 'Sapindaceae', '#0084ff'],
		ACSA1: ['Silver Maple', 'Acer', 'saccharinum', 'Sapindaceae', '#c3c3c3'],
		FRPE: ['Green Ash', 'Fraxinus', 'pennsylvanica', 'Oleaceae', '#007e59'],
		GLTR: ['Honeylocust', 'Gleditsia', 'triacanthos', 'Fabaceae', '#dcab00'],
		TICO: ['Littleleaf Linden', 'Tilia', 'cordata', 'Tiliaceae', '#006ddc'],
		PYCA: ['Callery Pear', 'Pyrus ', 'calleryana', 'Rosaceae', '#00dc53'],
		QUPA: ['Pin Oak', 'Quercus', 'palustris', 'Fagaceae', '#739351'],
		PLAC: ['London Planetree', 'Platanus', 'X acerfolia', 'Platanaceae', '#da4c4c'],
		GIBI: ['Ginkgo', 'Ginkgo', 'biloba', 'Ginkgoaceae', '#deee27'],
		SYRE: ['Japanese Tree Lilac', 'Syringa', 'reticulata', 'Oleaceae', '#b827ee'],
		COFL: ['Flowering Dogwood', 'Cornus', 'florida', 'Cornaceae', '#ee27a6'],
		CEJA: ['Katsura Tree', 'Cercidiphyllum', 'japonicum', 'Cercidiphyllaceae', '#385b9a'],
		AEHI: ['Horsechestnut', 'Aesculus', 'hippocastanum', 'Sapindaceae', '#193569'],
		ACPLCK: ['Norway Maple Crimson King', 'Acer', 'platanoides Crimson King', 'Sapindaceae', '#ff0030'],
		ACSA2: ['Sugar Maple', 'Acer', 'saccharum', 'Sapindaceae', '#61827a'],
		ACCA: ['Hedge Maple', 'Acer', 'campestre', 'Sapindaceae', '#39806f'],
		ACGI: ['Amur Maple', 'Acer', 'ginnala', 'Sapindaceae', '#04646d'],
		ACPA: ['Japanese Maple', 'Acer', 'palmatum', 'Sapindaceae', '#01a3e7'],
		ACPS: ['Sycamore Maple', 'Acer', 'pseudoplatanus', 'Sapindaceae', '#3c9eac'],
		STJA2: ['Japanese Pagoda Tree', 'Sophora', 'japonica', 'Fabaceae', '#0b6d7c'],
		ROPS: ['Black Locust', 'Robinia', 'pseudoacacia', 'Fabaceae', '#000'],
		ULAM: ['American Elm', 'Ulmus', 'americana', 'Ulmaceae', '#cd3a00'],
		ULPA: ['Chinese Elm', 'Ulmus', 'parvifolia', 'Ulmaceae', '#7c2b0b'],
		ZESE: ['Japanese Zelkova', 'Zelkova', 'serrata', 'Ulmaceae', '#00cd05'],			
		LIST: ['Sweetgum', 'Liquidambar', 'styraciflua', 'Altingiaceae', '#cd6f00'],
		GYDI: ['Kentucky Coffeetree', 'Gymnocladus', 'dioicus', 'Fabaceae', '#61390a'],
		AIAL: ['Tree of Heaven', 'Ailanthus', 'altissima', 'Simaroubaceae', '#fff4c8'],
		KOPA: ['Goldenrain Tree', 'Koelreuteria', 'paniculata', 'Sapindaceae', '#e0b712'],
		CECA: ['Eastern Redbud', 'Cercis', 'canadensis', 'Fabaceae', '#7b0c21'],
		LITU: ['Tulip Tree', 'Liriodendron', 'tulipifera', 'Magnoliaceae', '#b2223d'],
		TIAM: ['American Linden', 'Tilia', 'americana', 'Tiliaceae', '#81d4d9'],
		TITO: ['Silver Linden', 'Tilia', 'tomentosa', 'Malvaceae', '#759395'],
		CR: ['Hawthorn', 'Crataegus', 'monogyna', 'Rosaceae', '#458b89'],
		MA2: ['Crabapple', 'Malus', '', 'Rosaceae', '#9f001a'],
		PR: ['Flowering Cherry', 'Prunus', 'serrulata', 'Rosaceae', '#6b0037'],
		BE: ['Birch', 'Betula', '', 'Betulaceae', '#096d67'],
		PRVISH: ['Schubert Cherry', 'Prunus', 'virginiana Schubert', 'Rosaceae', '#653e55'],
		PRCE: ['Purpleleaf Plum', 'Prunus', 'cerasifera', 'Rosaceae', '#6f174b'],
		AM: ['Serviceberry', 'Amelanchier', 'arborea', 'Rosaceae', '#22148c'],
		CEOC: ['Hackberry', 'Celtis', 'occidentalis', 'Cannabaceae', '#94ac7d'],
		CABE: ['European Hornbeam', 'Carpinus', 'betulus', 'Betulaceae', '#4f8c14'],
		QUPH: ['Willow Oak', 'Quercus', 'phellos', 'Fagaceae', '#96a5c2'],
		QUAC: ['Sawtooth Oak', 'Quercus', 'acutissima', 'Fagaceae', '#fff0ff'],
		MA1: ['Magnolia', 'Magnolia', '', 'Magnoliaceae', '#777f8d'],
		PO: ['Poplar', 'Populus', '', 'Salicaceae', '#a0d9d3'],
		MO: ['Mulberry', 'Morus', '', 'Moraceae', '#d9a0cf'],
		QURU: ['Northern Red Oak', 'Quercus', 'rubra', 'Fagaceae', '#aa1639'],
		QUBI: ['Swamp White Oak', 'Quercus', 'bicolor', 'Fagaceae', '#eab3c0'],
		QURO: ['English Oak', 'Quercus', 'robur', 'Fagaceae', '#30526c'],
		QUAL: ['White Oak', 'Quercus', 'alba', 'Fagaceae', '#fff'],
		MEGL: ['Dawn Redwood', 'Metasequoia', 'glyptostroboides', 'Cupressaceae', '#f7a228'],
		PIST: ['Eastern White Pine', 'Pinus', 'strobus', 'Pinaceae', '#c9ffab'],
		TADI: ['Baldcypress', 'Taxodium', 'distichum', 'Cupressaceae', '#ff8034'],
};

var tip = d3.tip()
		.attr('class', 'd3-tip')
		.offset([-10, 0])
		.html(function(d) { 
			if ( d.SPECIES == "ACPL" ) { return "Norway Maple"
					} else if ( d.SPECIES == "ACRU" ) { return "Red Maple"
					} else if ( d.SPECIES == "ACSA1" ) { return "Silver Maple"
					} else if ( d.SPECIES == "FRPE" ) { return "Green Ash"
					} else if ( d.SPECIES == "GLTR" ) { return "Honeylocust"
					} else if ( d.SPECIES == "TICO" ) { return "Littleleaf Linden"
					} else if ( d.SPECIES == "PYCA" ) { return "Callery Pear"
					} else if ( d.SPECIES == "QUPA" ) { return "Pin Oak"
					} else if ( d.SPECIES == "PLAC" ) { return "London Planetree"
					} else if ( d.SPECIES == "GIBI" ) { return "Ginkgo"
					} else if ( d.SPECIES == "SYRE" ) { return "Japanese Tree Lilac"
					} else if ( d.SPECIES == "COFL" ) { return "Flowering Dogwood"
					} else if ( d.SPECIES == "CEJA" ) { return "Katsura Tree"
					} else if ( d.SPECIES == "AEHI" ) { return "Horsechestnut"
					} else if ( d.SPECIES == "ACPLCK" ) { return "Norway Maple Crimson King"
					} else if ( d.SPECIES == "ACSA2" ) { return "Sugar Maple"
					} else if ( d.SPECIES == "ACCA" ) { return "Hedge Maple"
					} else if ( d.SPECIES == "ACGI" ) { return "Amur Maple"
					} else if ( d.SPECIES == "ACPA" ) { return "Japanese Maple"
					} else if ( d.SPECIES == "ACPS" ) { return "Sycamore Maple"
					} else if ( d.SPECIES == "STJA2" ) { return "Japanese Pagoda Tree"
					} else if ( d.SPECIES == "ROPS" ) { return "Black Locust"
					} else if ( d.SPECIES == "ULAM" ) { return "American Elm"
					} else if ( d.SPECIES == "ULPA" ) { return "Chinese Elm"
					} else if ( d.SPECIES == "ZESE" ) { return "Zelkova"
					} else if ( d.SPECIES == "LIST" ) { return "Sweetgum"
					} else if ( d.SPECIES == "GYDI" ) { return "Kentucky Coffeetree"
					} else if ( d.SPECIES == "AIAL" ) { return "Tree of Heaven"
					} else if ( d.SPECIES == "KOPA" ) { return "Goldenrain Tree"
					} else if ( d.SPECIES == "CECA" ) { return "Eastern Redbud"
					} else if ( d.SPECIES == "LITU" ) { return "Tulip Tree"
					} else if ( d.SPECIES == "TIAM" ) { return "American Linden"
					} else if ( d.SPECIES == "TITO" ) { return "Silver Linden"
					} else if ( d.SPECIES == "CR" ) { return "Hawthorn"
					} else if ( d.SPECIES == "MA2" ) { return "Crabapple"
					} else if ( d.SPECIES == "PR" ) { return "Flowering Cherry"
					} else if ( d.SPECIES == "BE" ) { return "Birch"
					} else if ( d.SPECIES == "PRVISH" ) { return "Schubert Cherry"
					} else if ( d.SPECIES == "PRCE" ) { return "Purpleleaf Plum"
					} else if ( d.SPECIES == "AM" ) { return "Serviceberry"
					} else if ( d.SPECIES == "CEOC" ) { return "Hackberry"
					} else if ( d.SPECIES == "CABE" ) { return "European Hornbeam"
					} else if ( d.SPECIES == "QUPH" ) { return "Willow Oak"
					} else if ( d.SPECIES == "QUAC" ) { return "Sawtooth Oak"
					} else if ( d.SPECIES == "MA1" ) { return "Magnolia"
					} else if ( d.SPECIES == "PO" ) { return "Poplar"
					} else if ( d.SPECIES == "MO" ) { return "Mulberry"
					} else if ( d.SPECIES == "QURU" ) { return "Northern Red Oak"
					} else if ( d.SPECIES == "QUBI" ) { return "Swamp White Oak"
					} else if ( d.SPECIES == "QURO" ) { return "English Oak"
					} else if ( d.SPECIES == "QUAL" ) { return "White Oak"
					} else if ( d.SPECIES == "MEGL" ) { return "Dawn Redwood"
					} else if ( d.SPECIES == "PIST" ) { return "Eastern White Pine"
					} else if ( d.SPECIES == "TADI" ) { return "Baldcypress"
					} else { return "Unknown";
}})
			
		points.call(tip);
		
zoomed();

function createMap(data) {
	var scale = zoom.scale() / 10000000000 + 1
	d3.select("#points").selectAll("circle").data(data) //plotted 	locations on map
	.enter()
	.append("circle")
	.style("fill", function(d) {
				if ( d.SPECIES == "ACPL" ) { return "#00567e"
					} else if ( d.SPECIES == "ACRU" ) { return "#0084ff"
					} else if ( d.SPECIES == "ACSA1" ) { return "#c3c3c3"
					} else if ( d.SPECIES == "FRPE" ) { return "#007e59"
					} else if ( d.SPECIES == "GLTR" ) { return "#dcab00"
					} else if ( d.SPECIES == "TICO" ) { return "#006ddc"
					} else if ( d.SPECIES == "PYCA" ) { return "#00dc53"
					} else if ( d.SPECIES == "QUPA" ) { return "#739351"
					} else if ( d.SPECIES == "PLAC" ) { return "#e53b00"
					} else if ( d.SPECIES == "GIBI" ) { return "#deee27"
					} else if ( d.SPECIES == "SYRE" ) { return "#b827ee"
					} else if ( d.SPECIES == "COFL" ) { return "#ee27a6"
					} else if ( d.SPECIES == "CEJA" ) { return "#385b9a"
					} else if ( d.SPECIES == "AEHI" ) { return "#193569"
					} else if ( d.SPECIES == "ACPLCK" ) { return "#ff0030"
					} else if ( d.SPECIES == "ACSA2" ) { return "#61827a"
					} else if ( d.SPECIES == "ACCA" ) { return "#39806f"
					} else if ( d.SPECIES == "ACGI" ) { return "#04646d"
					} else if ( d.SPECIES == "ACPA" ) { return "#01a3e7"
					} else if ( d.SPECIES == "ACPS" ) { return "#3c9eac"
					} else if ( d.SPECIES == "STJA2" ) { return "#0b6d7c"
					} else if ( d.SPECIES == "ROPS" ) { return "#000"
					} else if ( d.SPECIES == "ULAM" ) { return "#cd3a00"
					} else if ( d.SPECIES == "ULPA" ) { return "#7c2b0b"
					} else if ( d.SPECIES == "ZESE" ) { return "#00cd05"
					} else if ( d.SPECIES == "LIST" ) { return "#cd6f00"
					} else if ( d.SPECIES == "GYDI" ) { return "#61390a"
					} else if ( d.SPECIES == "AIAL" ) { return "#fff4c8"
					} else if ( d.SPECIES == "KOPA" ) { return "#e0b712"
					} else if ( d.SPECIES == "CECA" ) { return "#7b0c21"
					} else if ( d.SPECIES == "LITU" ) { return "#b2223d"
					} else if ( d.SPECIES == "TIAM" ) { return "#81d4d9"
					} else if ( d.SPECIES == "TITO" ) { return "#759395"
					} else if ( d.SPECIES == "CR" ) { return "#458b89"
					} else if ( d.SPECIES == "MA2" ) { return "#9f001a"
					} else if ( d.SPECIES == "PR" ) { return "#6b0037"
					} else if ( d.SPECIES == "BE" ) { return "#096d67"
					} else if ( d.SPECIES == "PRVISH" ) { return "#653e55"
					} else if ( d.SPECIES == "PRCE" ) { return "#6f174b"
					} else if ( d.SPECIES == "AM" ) { return "#22148c"
					} else if ( d.SPECIES == "CEOC" ) { return "#94ac7d"
					} else if ( d.SPECIES == "CABE" ) { return "#4f8c14"
					} else if ( d.SPECIES == "QUPH" ) { return "#96a5c2"
					} else if ( d.SPECIES == "QUAC" ) { return "#"
					} else if ( d.SPECIES == "MA1" ) { return "#777f8d"
					} else if ( d.SPECIES == "PO" ) { return "#a0d9d3"
					} else if ( d.SPECIES == "MO" ) { return "#d9a0cf"
					} else if ( d.SPECIES == "QURU" ) { return "#aa1639"
					} else if ( d.SPECIES == "QUBI" ) { return "#eab3c0"
					} else if ( d.SPECIES == "QURO" ) { return "#30526c"
					} else if ( d.SPECIES == "QUAL" ) { return "#fff"
					} else if ( d.SPECIES == "MEGL" ) { return "#f7a228"
					} else if ( d.SPECIES == "PIST" ) { return "#c9ffab"
					} else if ( d.SPECIES == "TADI" ) { return "#ff8034"
					} else { return "#999";
			 	}})
	.style("opacity", 0.7)
	.attr("r", function(d) { 
		if ( d.DIAMETER <= 10 ) { return .0000003*zoom.scale()
			} else if ( d.DIAMETER > 10 && d.DIAMETER <= 20 ) { return .0000006*zoom.scale()
			} else if ( d.DIAMETER > 20 && d.DIAMETER <= 45 ) { return .0000012*zoom.scale()
			} else if ( d.DIAMETER > 45 ) { return .0000018*zoom.scale();
		}})
	.attr("id", function(d) { return d.SPECIES })
	.attr("cx", function(d) {return projection([d.longitude,d.latitude])[0]})
	.attr("cy", function(d) {return projection([d.longitude,d.latitude])[1]})
	.on('mouseover', tip.show)
	.on('mouseout', tip.hide);
	zoomed();
	
// Species Filters (individual tree)
	var filter1 = d3.select("#filter1")
			// Add the filter
			filter1.append("text")
				.attr("id", "legend")
				.on("click", function(){
						// Determine if current line is visible
						var active   = PLAC.active ? false : true ,
						newOpacity = active ? 0 : 1;
						// Hide or show the elements
						d3.selectAll("#PLAC").style("opacity", newOpacity);
						// Update whether or not the elements are active
						PLAC.active = active;
						})
						.text("London Plane");

			filter1.append("text")
					.attr("id", "legend")
					.on("click", function(){
							// Determine if current line is visible
							var active   = PLAC.active ? false : true ,
							newOpacity = active ? 0 : 1;
							// Hide or show the elements
							d3.selectAll("#PYCA").style("opacity", newOpacity);
							// Update whether or not the elements are active
							PLAC.active = active;
							})
							.text("Callery Pear");
							
			filter1.append("text")
					.attr("id", "legend")
					.on("click", function(){
							// Determine if current line is visible
							var active   = PLAC.active ? false : true ,
							newOpacity = active ? 0 : 1;
							// Hide or show the elements
							d3.selectAll("#GIBI").style("opacity", newOpacity);
							// Update whether or not the elements are active
							PLAC.active = active;
							})
							.text("Ginkgo");
						
// Genus Filters							
			var filter2 = d3.select("#filter2")
					// Add the filter
					filter2.append("text")
					.attr("id", "legend")
					.on("click", function(){
							// Determine if current line is visible
							var active   = PLAC.active ? false : true ,
							newOpacity = active ? 0 : 1;
							// Hide or show the elements
							d3.selectAll("#GIBI, #PYCA, #TICO, #PLAC").style("opacity", newOpacity);
							// Update whether or not the elements are active
							PLAC.active = active;
							})
							.text("Sample Group");


// Family Filters
				var filter3 = d3.select("#filter3")
						// Add the filter
						filter3.append("text")
						.attr("id", "legend")
						.on("click", function(){
									// Determine if current line is visible
									var active   = PLAC.active ? false : true ,
									newOpacity = active ? 0 : 1;
									// Hide or show the elements
									d3.selectAll("#GIBI, #PYCA, #TICO, #PLAC").style("opacity", newOpacity);
									// Update whether or not the elements are active
									PLAC.active = active;
									})
									.text("Sample Fam");							
												
}

function zoomed() {
  var tiles = tile
      .scale(zoom.scale())
      .translate(zoom.translate())
      ();

  projection
      .scale(zoom.scale() / 2 / Math.PI)
      .translate(zoom.translate());

			d3.selectAll("#points").selectAll("circle")
			.attr("cx", function(d) {return projection([d.longitude,d.latitude])[0]})
			.attr("cy", function(d) {return projection([d.longitude,d.latitude])[1]})
			.attr("r", function(d) { 
				if ( d.DIAMETER <= 10 ) { return .0000003*zoom.scale()
					} else if ( d.DIAMETER > 10 && d.DIAMETER <= 20 ) { return .0000006*zoom.scale()
					} else if ( d.DIAMETER > 20 && d.DIAMETER <= 45 ) { return .0000012*zoom.scale()
					} else if ( d.DIAMETER > 45 ) { return .0000018*zoom.scale();
				}})

  var image = layer
      .style(prefix + "transform", matrix3d(tiles.scale, tiles.translate))
    .selectAll(".tile")
      .data(tiles, function(d) { return d; });

  image.exit()
      .remove();

  image.enter().append("img")
      .attr("class", "tile")
      .attr("src", function(d) { return "http://" + ["a", "b", "c"][Math.random() * 3 | 0] + ".basemaps.cartocdn.com/dark_all/" + d[2] + "/" + d[0] + "/" + d[1] + ".png"; })
      .style("left", function(d) { return (d[0] << 8) + "px"; })
      .style("top", function(d) { return (d[1] << 8) + "px"; });
}


function interpolateZoom (translate, scale) {
    var self = this;
    return d3.transition().duration(350).tween("zoom", function () {
        var iTranslate = d3.interpolate(zoom.translate(), translate),
            iScale = d3.interpolate(zoom.scale(), scale);
        return function (t) {
            zoom
                .scale(iScale(t))
                .translate(iTranslate(t));
            zoomed();
        };
    });
}

function zoomClick() {
    var clicked = d3.event.target,
        direction = 1,
        factor = 0.2,
        target_zoom = 1,
        center = [width / 2, height / 2],
        extent = zoom.scaleExtent(),
        translate = zoom.translate(),
        translate0 = [],
        l = [],
        view = {x: translate[0], y: translate[1], k: zoom.scale()};

    d3.event.preventDefault();
    direction = (this.id === 'zoom_in') ? 1 : -1;
    target_zoom = zoom.scale() * (1 + factor * direction);

    if (target_zoom < extent[0] || target_zoom > extent[1]) { return false; }

    translate0 = [(center[0] - view.x) / view.k, (center[1] - view.y) / view.k];
    view.k = target_zoom;
    l = [translate0[0] * view.k + view.x, translate0[1] * view.k + view.y];

    view.x += center[0] - l[0];
    view.y += center[1] - l[1];

    interpolateZoom([view.x, view.y], view.k);
}

d3.selectAll('button').on('click', zoomClick);

$(function() {
  $( "#accordion" ).accordion({
    collapsible: true
  });
});

function matrix3d(scale, translate) {
  var k = scale / 256, r = scale % 1 ? Number : Math.round;
  return "matrix3d(" + [k, 0, 0, 0, 0, k, 0, 0, 0, 0, k, 0, r(translate[0] * scale), r(translate[1] * scale), 0, 1 ] + ")";
}

function prefixMatch(p) {
  var i = -1, n = p.length, s = document.body.style;
  while (++i < n) if (p[i] + "Transform" in s) return "-" + p[i].toLowerCase() + "-";
  return "";
}

function formatLocation(p, k) {
  var format = d3.format("." + Math.floor(Math.log(k) / 2 - 2) + "f");
  return (p[1] < 0 ? format(-p[1]) + "째S" : format(p[1]) + "째N") + " "
       + (p[0] < 0 ? format(-p[0]) + "째W" : format(p[0]) + "째E");
}

</script>
</body>
</html>